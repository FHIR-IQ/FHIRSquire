# Getting Started with FHIRSquire

This guide will walk you through setting up and using FHIRSquire for the first time.

## Prerequisites

Before you begin, ensure you have:

1. **Node.js 18+** and **npm 9+** installed
   - Check with: `node --version` and `npm --version`
   - Download from: https://nodejs.org/

2. **Anthropic API Key** (Required)
   - Sign up at: https://console.anthropic.com/
   - Create an API key from your account settings
   - You'll need Claude API access (Sonnet model)

3. **Simplifier.net API Key** (Optional)
   - Only needed if you want to upload profiles to Simplifier.net
   - Sign up at: https://simplifier.net
   - Generate API key from account settings

## Installation

### 1. Clone the Repository

```bash
git clone <your-repo-url>
cd FHIRSquire
```

### 2. Install Dependencies

```bash
npm install
```

This will install dependencies for both the frontend and backend workspaces.

### 3. Configure Environment Variables

#### Backend Configuration

1. Navigate to the backend directory:
   ```bash
   cd backend
   ```

2. Copy the example environment file:
   ```bash
   cp .env.example .env
   ```

   On Windows:
   ```cmd
   copy .env.example .env
   ```

3. Edit the `.env` file and add your API keys:
   ```
   ANTHROPIC_API_KEY=sk-ant-api03-your-actual-key-here
   SIMPLIFIER_API_KEY=your-simplifier-key-here  # Optional
   ```

4. Return to the root directory:
   ```bash
   cd ..
   ```

## Running the Application

### Start Both Frontend and Backend

From the root directory:

```bash
npm run dev
```

This will start:
- Backend API on http://localhost:3001
- Frontend UI on http://localhost:5173

### Or Run Separately

**Backend only:**
```bash
npm run dev:backend
```

**Frontend only:**
```bash
npm run dev:frontend
```

## Using FHIRSquire

### Step 1: Define Your Use Case

1. Open http://localhost:5173 in your browser
2. Fill out the use case form with:
   - **Business Use Case**: What problem are you solving?
   - **Reason for Profile**: Why do you need a FHIR profile?
   - **Specific Use Case**: Who will use it and how?
   - **Data Role**: Are you consuming, producing, or intermediating data?
   - **FHIR Version**: Select R4, R5, or R6
   - **Organization Context**: Optional details about your setting

**Example:**
```
Business Use Case: Exchange patient allergy information between
our EHR and pharmacy systems to prevent adverse drug reactions.

Reason for Profile: Need to capture allergy severity and patient-
reported vs. clinician-confirmed status not in base FHIR.

Specific Use Case: Clinicians enter allergies during patient
intake. Pharmacists query allergies before dispensing medications.

Data Role: Intermediary (both reading and writing)
FHIR Version: R4
Organization Context: US-based hospital network, ONC 2015 Edition
```

3. Click **"Get Recommendations"**

### Step 2: Review AI Recommendations

Claude AI will analyze your use case and provide:

- **Analysis Summary**: Overview of your needs
- **Suggested Approach**: Use existing, extend existing, or create new profile
- **Profile Recommendations**: List of relevant FHIR profiles from known IGs
  - US Core profiles
  - International Patient Summary
  - Domain-specific IGs (mCODE, CARIN, etc.)

Each recommendation includes:
- Relevance score (0-100%)
- Reasoning for the recommendation
- Base resource type
- Must-support elements
- Required extensions
- Links to profile and IG documentation

**Select the recommendation** that best fits your needs.

Optionally, add **custom requirements** if you need additional constraints.

Click **"Proceed to Profile Generation"**

### Step 3: Generate FHIR Profile

1. Review the **Profile Specification** generated by Claude
   - This is a detailed markdown document describing the profile
   - Includes use case, scope, constraints, terminology bindings, etc.

2. Click **"Generate FHIR Profile"** to create the StructureDefinition

3. Review the generated profile:
   - View profile summary (ID, name, URL, base definition)
   - Click **"Show JSON"** to see the full FHIR StructureDefinition
   - **Download JSON** to save locally
   - **Save Locally** to store in the `profiles/` directory

4. Click **"Continue to Upload"**

### Step 4: Upload to Simplifier (Optional)

If you configured a Simplifier.net API key:

1. Select an existing project or create a new one
2. Click **"Upload to Simplifier"**
3. Your profile will be uploaded and you'll receive a link to view it on Simplifier.net

If you didn't configure Simplifier:
- Click **"Skip & Complete"** to finish
- You can still download and use the profile JSON

### Step 5: Start a New Use Case

Click **"Complete & Start New"** to begin another profile!

## Example Use Cases

### 1. Patient Demographics for Exchange

**Business Use Case:** Exchange patient demographic information with state immunization registry

**FHIR Version:** R4

**Expected Recommendation:** US Core Patient Profile

### 2. Lab Results Reporting

**Business Use Case:** Report laboratory results to public health authorities

**FHIR Version:** R4

**Expected Recommendation:** US Core Observation Lab Profile

### 3. Oncology Treatment Plans

**Business Use Case:** Share cancer treatment plans between oncology clinics

**FHIR Version:** R4

**Expected Recommendation:** mCODE profiles (Cancer Patient, Treatment Plan)

## Troubleshooting

### "Failed to analyze use case"

**Problem:** Claude API returns an error

**Solutions:**
- Check your `ANTHROPIC_API_KEY` is correct in `backend/.env`
- Verify you have API credits in your Anthropic account
- Check backend logs for detailed error messages
- Try restarting the backend: `npm run dev:backend`

### "Port already in use"

**Problem:** Port 3001 or 5173 is already occupied

**Solutions:**
- Kill the process using the port
- Change the port in:
  - Backend: `backend/.env` ‚Üí `PORT=3002`
  - Frontend: `frontend/vite.config.ts` ‚Üí `server.port: 5174`

### Frontend can't connect to backend

**Problem:** API calls fail with network errors

**Solutions:**
- Ensure backend is running: Check http://localhost:3001/health
- Check browser console for CORS errors
- Verify `FRONTEND_URL` in `backend/.env` matches your frontend URL

### Simplifier upload fails

**Problem:** "Simplifier integration not configured" or upload errors

**Solutions:**
- This feature is optional - you can skip it
- Verify `SIMPLIFIER_API_KEY` in `backend/.env`
- Check Simplifier.net API key is valid
- Review backend logs for API response details

## Next Steps

- Review the generated profiles in `profiles/` directory
- Add validation tests for your profiles
- Create example resources that conform to your profiles
- Share profiles with your development team
- Build an Implementation Guide on Simplifier.net

## Getting Help

- Review [README.md](README.md) for project overview
- Check [CLAUDE.md](CLAUDE.md) for architecture details
- Open an issue on GitHub for bugs or feature requests

## Tips

- **Be specific** in your use case descriptions - more detail = better recommendations
- **Include context** about your organization, country, and regulatory requirements
- **Review multiple recommendations** before selecting - Claude often provides several good options
- **Add custom requirements** to tailor the generated profile to your exact needs
- **Download profiles** before uploading to Simplifier - always keep local copies

Happy FHIR profiling! üè•
